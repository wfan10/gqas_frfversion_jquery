<!documentTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- IMPORTANT NOTICE: 
    Nice Admin META information should not be deleted per license agreement https://bootstrapmade.com/license  
    -->
  <meta name="description" content="Creative - Bootstrap 3 Responsive Admin Template">
  <meta name="author" content="GeeksLabs">
  <meta name="keyword" content="Creative, Dashboard, Admin, Template, Theme, Bootstrap, Responsive, Retina, Minimal">
  <!-- END Nice Admin meta information -->
  <link rel="shortcut icon" href="images/icons/favicon.ico">
  <title>GQAS Filter Selector</title>
  <!-- font icon -->
  <link href="css/elegant-icons-style.css" rel="stylesheet" />
  <link href="css/font-awesome.min.css" rel="stylesheet" />
  <!-- NICEADMIN Bootstrap CSS -->
  <link href="css/bootstrap.min.css" rel="stylesheet">
  <link href="css/bootstrap-theme.css" rel="stylesheet">
  <!-- Datatable CSS file-->
  <link href="css/jquery.dataTables.css" rel="stylesheet">
  <link href="css/buttons.dataTables.css" rel="stylesheet">
  <link href="css/select.dataTables.css" rel="stylesheet">
  <!-- Custom styles -->
  <link href="css/style.css" rel="stylesheet">
  <link href="css/style-responsive.css" rel="stylesheet">
  <!-- -->
  <style type="text/css">
    #tblfilter div.arrow {
      background: transparent url(images/icons/arrows.png) no-repeat scroll 0px -16px;
      width: 16px;
      height: 16px;
      display: block;
    }
    
    #tblfilter div.up {
      background-position: 0px 0px;
    }
  </style>
  <!-- JAVASCRIPT FILES BEGIN HERE -->
  <!-- underscore -->
  <script src="js/underscore1.8.3.js"></script>
  <!-- jquery files -->
  <script src="js/jquery-2.2.4.min.js"></script>
  <!-- jquery plug in files information: 
    scrollto https://plugins.jquery.com/scrollTo/ 
    nicescroll https://nicescroll.areaaperta.com/ -->
  <script src="js/jquery.scrollTo.min.js"></script>
  <script src="js/jquery.nicescroll.js"></script>
  <!-- -->
  <script src="js/bootstrap.min.js"></script>
  <!-- Datatable file must come after jQuery stuff -->
  <script src="js/jquery.dataTables.js"></script>
  <script src="js/dataTables.buttons.js"></script>
  <script src="js/dataTables.select.js"></script>
</head>

<body class="login-body">
  <!-- container section start -->
  <section id="container" class="">
    <!--header start-->
    <header class="header dark-bg">
      <div class="toggle-nav">
        <div class="icon-reorder tooltips" data-original-title="Toggle Navigation" data-placement="bottom"><i class="icon_menu"></i></div>
      </div>
      <span class="toggle-nav1">
        <img style="height:60px" src="images/icons/Ford-Oval-Pad.png">
      </span>
      <!--logo start-->
      <a href="index.html" target="_self" class="logo">Global Quality Application Services</a>
      <!--logo end-->
      <div class="top-nav notification-row">
        <!-- notificatoin dropdown start-->
        <ul class="nav pull-right top-menu">
          <!-- user login dropdown start-->
          <li class="dropdown">
            <a data-toggle="dropdown" class="dropdown-toggle" href="#">
              <span class="profile-ava">
                <img alt="" src="images/icons/awspref.ico">
              </span>
              <span class="username">GQAS Help</span>
              <b class="caret"></b>
            </a>
            <ul class="dropdown-menu extended logout">
              <li class="eborder-top">
                <a><i class="icon_profile"></i>email: awshelp@ford.com</a>
              </li>
              <li>
                <a><i class="icon_profile"></i>phone: 313-206-2790</a>
              </li>
              <li>
                <a href="https://dept.sp.ford.com/sites/QualityDept/SitePages/Home.aspx" target="_blank"><i class="icon_key_alt"></i>Quality Home</a>
              </li>
              <li>
                <a href="https://comm.extsp.ford.com/sites/awssupplier/Pages/Home.aspx" target="_blank"><i class="icon_key_alt"></i>Warranty Home</a>
              </li>
              <li>
                <a href="http://www.quality.ford.com/aws/aws/documentation/awssepdoc.html" target="_blank"><i class="icon_key_alt"></i>Documentation</a>
              </li>
            </ul>
          </li>
          <!-- user login dropdown end -->
        </ul>
        <!-- notificatoin dropdown end-->
      </div>
    </header>
    <!--header end-->
    <!--sidebar start-->
    <aside>
      <div id="sidebar" class="nav-collapse ">
        <!-- sidebar menu start -->
        <ul class="sidebar-menu">
          <li class="">
            <a class="" href="index.html" target="_self">
              <i class="icon_house_alt"></i>
              <span>Home</span>
            </a>
          </li>
          <li class="sub-menu">
            <a href="javascript:;" class="">
              <i class="icon_document_alt"></i>
              <span>Requests</span>
              <span class="menu-arrow arrow_carrot-right"></span>
            </a>
            <ul class="sub">
              <li><a class="" href="requests.html" target="_self">Request Manager</a></li>
              <li><a class="" href="usergroups.html" target="_self">Groups Editor</a></li>
              <li><a class="" href="customfilters.html" target="_self">Custom Filters</a></li>
            </ul>
          </li>
          <li class="sub-menu">
            <a href="javascript:;" class="">
              <i class="icon_desktop"></i>
              <span>Reports</span>
              <span class="menu-arrow arrow_carrot-right"></span>
            </a>
            <ul class="sub">
              <li><a class="" href="reports.html" target="_self">Report Manager</a></li>
            </ul>
          </li>
          <li class="sub-menu ">
            <a href="javascript:;" class="">
              <i class="icon_documents_alt"></i>
              <span>Pages</span>
              <span class="menu-arrow arrow_carrot-right"></span>
            </a>
            <ul class="sub">
              <li><a class="" href="reportselector.html" target="_self">Report Selector</a></li>
            </ul>
          </li>
        </ul>
        <!-- sidebar menu end-->
      </div>
    </aside>
    <!--sidebar end-->
    <!--main content start-->
    <section id="main-content">
      <section class="wrapper">
        <!-- page start
        Page content goes here 
        -->
        <div class="container-fluid">
          <div class="row">
            <div class="col-lg-6">
              <div id="fltrlist" class="panel panel-default">
                <div class="panel-heading">
                  Filter List
                </div>
                <div class="panel-body">
                  <!-- Datatable here -->
                  <table id="tblFltrSelect" class="table table-bordered table-responsive" cellspacing="0" width="100%">
                    <thead>
                      <tr>
                        <th>Group</th>
                        <th>Options</th>
                        <th>Filters</th>
                        <th class="hidden">group_name</th>
                        <th class="hidden">filter_option_list</th>
                        <th class="hidden">filter_pointer</th>
                        <th class="hidden">oper_grp_id</th>
                        <th class="hidden">filter_id</th>
                        <th class="hidden">filter_loaded</th>
                        <th class="hidden">filter_use</th>
                        <th class="hidden">filter_col_type</th>
                        <th class="hidden">filter_single_sel</th>
                        <th class="hidden">filter_qas_col1</th>
                        <th class="hidden">filter_qas_col2</th>
                        <th class="hidden">filter_qas_col3</th>
                        <th class="hidden">filter_qas_col4</th>
                        <th class="hidden">filter_qas_col5</th>
                      </tr>
                    </thead>
                    <tbody>
                    </tbody>
                    <tfoot>
                    </tfoot>
                  </table>
                </div>
                <div class="panel-footer">
                  <a id="btnOpt" class="btn btn-default" data-toggle="modal" href="#myModal">Filter Options</a>
                  <!--a id="btnOpt" class="btn btn-default" data-toggle="modal">Filter Options</a -->
                </div>
              </div>
            </div>
            <div class="col-lg-6">
              <div id="fltrValue" class="panel panel-default">
                <div class="panel-heading">Filter Values</div>
                <div class="panel-body">
                  <!-- DataTable here -->
                  <table id="tblFltrValues" class="table table-bordered table-responsive" cellspacing="0" width="100%">
                    <thead>
                      <tr>
                        <th>DESCRIPTION</th>
                        <th>VAL_COL1</th>
                        <th>VAL_COL2</th>
                        <th>VAL_COL3</th>
                        <th>VAL_COL4</th>
                        <th>VAL_COL5</th>
                        <th class="hidden">GROUP_ID</th>
                        <th class="hidden">GROUP_OWNER</th>
                        <th class="hidden">GROUP_NAME</th>
                    </thead>
                    <tfoot>
                    </tfoot>
                    <tbody>
                    </tbody>
                  </table>
                </div>
                <div class="panel-footer">
                  <button id="btnVAdd" class="btn btn-default" type="button">Add Values</button>
                </div>
              </div>
            </div>
          </div>
          <!-- filter summary DataTable here -->
          <div class="row">
            <div class="col-lg-12">
              <table id="tblfilter" class="table table-bordered table-responsive" cellspacing="0" width="100%">
                <thead>
                  <tr>
                    <th>Crit_Num</th>
                    <th class="hidden">Filter ID</th>
                    <th class="hidden">Filter Group</th>
                    <th class="hidden">Operator ID</th>
                    <th class="hidden">Filter Options</th>
                    <th class="hidden">Field Type</th>
                    <th class="hidden">Field Name</th>
                    <th class="hidden">Options List</th>
                    <th class="hidden">Group ID</th>
                    <th>Filter</th>
                    <th>Operator</th>
                    <th class="hidden">Values</th>
                    <th>Values</th>
                    <th></th>
                  </tr>
                </thead>
                <tfoot>
                </tfoot>
                <tbody>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </section>
      <!-- Modal dialogs here -->
      <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
              <h4 class="modal-title">Filter Options</h4>
            </div>
            <div class="modal-body">
              <ul class="nav nav-tabs">
                <li role="presentation" class="dropdown active">
                  <a class="dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">
                                Operator<span class="caret"></span>
                              </a>
                  <ul id="lbOper" class="dropdown-menu">
                    <script type="text/template" class="opertemplate">
                      <% _.each( rc.operators, function( item,key,list ){ %>
                        <li <% print( 'id="' + item.oper_id + '"' ); %> >
                          <a href="#">
                            <% print( item.oper_desc ); %>
                          </a>
                        </li>
                        <% }); %>
                    </script>
                  </ul>
                  <input id="lbOperTxt" type="text" class="form-control" value="= (Equals)" idVal="1" aria-label="..." disabled>
                  <script type="text/javascript">
                    $("#lbOper").on("click", "li", function() {
                      var liVal = $(this).text();
                      var idVal = $(this).attr("id");
                      var $input = $(this).parent().next("input");
                      $input.attr("value", $.trim(decodeURI(liVal)));
                      $input.attr("idVal", $.trim(idVal));
                    })
                  </script>
                </li>
                <li role="presentation" class="dropdown">
                  <a class="dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">
                                List Options <span class="caret"></span>
                              </a>
                  <ul id="lbOpt" class="dropdown-menu">
                    <script type="text/template" class="optiontemplate">
                      <% _.each( rc.options, function( item,key,list ){ %>
                        <li <% print( 'id="' + item.optId + '"'); %>>
                          <a href="#">
                            <% print( item.optDesc ); %>
                          </a>
                        </li>
                        <% }); %>
                    </script>
                  </ul>
                  <input id="lbOptTxt" type="text" class="form-control" value="(V)Values Only" idVal="V" aria-label="..." disabled>
                  <script type="text/javascript">
                    $("#lbOpt").on("click", "li", function() {
                      var liVal = $(this).text();
                      var idVal = $(this).attr("id");
                      var $input = $(this).parent().next("input");
                      $input.attr("value", $.trim(liVal));
                      $input.attr("idVal", $.trim(idVal));
                    })
                  </script>
                </li>
                <li role="presentation" class="dropdown">
                  <a id="validtoggle" class="dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">
                                Valid Rows <span class="caret"></span>
                              </a>
                  <ul id="lbValid" class="dropdown-menu">
                    <li id="-"><a href="#">Return All Rows</a></li>
                    <li id="+"><a href="#">Valid Rows Only</a></li>
                  </ul>
                  <input id="lbValidTxt" type="text" class="form-control" value="Return All Rows" idVal="-" aria-label="..." disabled>
                  <script type="text/javascript">
                    $("#lbValid").on("click", "li", function() {
                      var liVal = $(this).text();
                      var idVal = $(this).attr("id");
                      var $input = $(this).parent().next("input");
                      $input.attr("value", $.trim(liVal));
                      $input.attr("idVal", $.trim(idVal));
                    });
                  </script>
                </li>
              </ul>
              <div class="panel panel-default">
                <div class="panel-heading">
                  <a id="btnShowInfo" href="#" class="btn btn-primary" role="button">Filter Information</a>
                </div>
                <div id="finfo" class="panel-body">
                  <h3>Filter Information Here</h3> Cras justo odio, dapibus ac facilisis in, egestas eget quam. Donec id elit non mi porta gravida at eget metus. Nullam id dolor id nibh ultricies vehicula ut id elit.
                </div>
              </div>
              <script type="text/javascript">
                $("#finfo").hide();
                $("#btnShowInfo").on("click", function() {
                  $("#finfo").toggle();
                });
              </script>
            </div>
            <div class="modal-footer">
              <button data-dismiss="modal" class="btn btn-default" type="button">Close</button>
              <button id="optSave" class="btn btn-primary" type="button">Get Values</button>
            </div>
          </div>
        </div>
      </div>
      <!-- End Modal dialogs -->
    </section>
    <!--main content end-->
  </section>
  <!-- container section end -->
  <!--  -->
  <script id="trow-main" type="text/template">
    <tr id=<%=crit_num%> >
      <td>
        <%=crit_num%>
      </td>
      <td class="hidden">
        <%=filter_id%>
      </td>
      <td class="hidden">
        <%=group_id%>
      </td>
      <td class="hidden">
        <%=oper_id%>
      </td>
      <td class="hidden">
        <%=filter_opt%>
      </td>
      <td class="hidden">
        <%=filter_col_type%>
      </td>
      <td class="hidden">
        <%=filter_qas_col1%>
      </td>
      <td class="hidden">
        <%=filter_option_list%>
      </td>
      <td class="hidden">
        <%=group_id_1%>
      </td>
      <td>
        <%=filter_desc%>
      </td>
      <td>
        <%=sql_oper%>
      </td>
      <td class="toggle">
        <% print( val_desc + '(' + val_col1 + ') ...'); %>
      </td>
      <td class="toggle">
        <ul>
          <li>
            <% print( val_desc + '(' + val_col1 + ')'); %>
          </li>
        </ul>
      </td>
      <td>
        <div class="arrow"></div>
      </td>
  </script>
  <script id="trow-details" type="text/template">
    <li>
      <% print( val_desc + '(' + val_col1 + ')'); %>
    </li>
  </script>
  <!-- -->
  <!--custom script for all page-->
  <script src="scripts/scripts.js"></script>
  <!-- GQAS Application Files -->
  <script src="scripts/jqPlugins.js"></script>
  <script src="scripts/jqFramework.js"></script>
  <!-- -->
  <script>
    (function($, win) {
      /*
       * Create window application constructors and objects here. 
       * 
       */
      // Your javascript code here. 
      var crit_items = [{
        "crit_num": 0,
        "filter_id": "F_MY",
        "group_id": 2,
        "oper_id": 1,
        "filter_opt": "V",
        "sql_oper": "=",
        "filter_desc": "Model Year",
        "filter_col_type": "VARCHAR2",
        "filter_qas_col1": "MDL_YR",
        "filter_option_list": "SV+",
        "group_id_1": 0,
        "val_desc": "MY_13",
        "val_col1": "2013"
      }, {
        "crit_num": 1,
        "filter_id": "F_COVFCC",
        "group_id": 1,
        "oper_id": 1,
        "filter_opt": "V",
        "sql_oper": "=",
        "filter_desc": "Cost Category",
        "filter_col_type": "VARCHAR2",
        "filter_qas_col1": "FCC_AUTH_CD",
        "filter_qas_col2": "FCC_BIN_CD",
        "filter_option_list": "SVGT",
        "group_id_1": 0,
        "val_desc": " All Vehicle Coverages / Contractual",
        "val_col1": "1"
      }, {
        "crit_num": 2,
        "filter_id": "F_PLNT",
        "group_id": 2,
        "oper_id": 1,
        "filter_opt": "VG",
        "sql_oper": "=",
        "filter_desc": "Assembly Plant [AAG]",
        "filter_col_type": "VARCHAR2",
        "filter_qas_col1": "PLANT_CD",
        "filter_option_list": "SVGT+",
        "group_id_1": 0,
        "val_desc": "DEARBORN PLANT BUILD",
        "val_col1": "AF"
      }, {
        "crit_num": 2,
        "filter_id": "F_PLNT",
        "group_id": 2,
        "oper_id": 1,
        "filter_opt": "VG",
        "sql_oper": "=",
        "filter_desc": "Assembly Plant [AAG]",
        "filter_col_type": "VARCHAR2",
        "filter_qas_col1": "PLANT_CD",
        "filter_option_list": "SVGT+",
        "group_id_1": 0,
        "val_desc": "CHICAGO PLANT BUILD",
        "val_col1": "AD"
      }, {
        "crit_num": 3,
        "filter_id": "F_ENG",
        "group_id": 2,
        "oper_id": 1,
        "filter_opt": "VG+",
        "sql_oper": "=",
        "filter_desc": "Engine [EN]",
        "filter_col_type": "VARCHAR2",
        "filter_qas_col1": "ENG_CD",
        "filter_option_list": "SVGT+",
        "group_id_1": 0,
        "val_desc": "3.5L V6 CYCLONE TIVCT",
        "val_col1": "C/KX"
      }, {
        "crit_num": 3,
        "filter_id": "F_ENG",
        "group_id": 2,
        "oper_id": 1,
        "filter_opt": "VG+",
        "sql_oper": "=",
        "filter_desc": "Engine [EN]",
        "filter_col_type": "VARCHAR2",
        "filter_qas_col1": "ENG_CD",
        "filter_option_list": "SVGT+",
        "group_id_1": 0,
        "val_desc": "3.5L-4V DOHC T/C V6 GAS 350HP",
        "val_col1": "C/TA"
      }, {
        "crit_num": 3,
        "filter_id": "F_ENG",
        "group_id": 2,
        "oper_id": 1,
        "filter_opt": "VG+",
        "sql_oper": "=",
        "filter_desc": "Engine [EN]",
        "filter_col_type": "VARCHAR2",
        "filter_qas_col1": "ENG_CD",
        "filter_option_list": "SVGT+",
        "group_id_1": 0,
        "val_desc": "3.5L-4V DOHC T/C V6 GAS 350HP",
        "val_col1": "T/TA"
      }, {
        "crit_num": 3,
        "filter_id": "F_ENG",
        "group_id": 2,
        "oper_id": 1,
        "filter_opt": "VG+",
        "sql_oper": "=",
        "filter_desc": "Engine [EN]",
        "filter_col_type": "VARCHAR2",
        "filter_qas_col1": "ENG_CD",
        "filter_option_list": "SVGT+",
        "group_id_1": 0,
        "val_desc": "3.5L V6 GAS DOHC TIVCT",
        "val_col1": "T/KW"
      }];

      //var tableRow1Tmpl = $("#table-row1").html();
      var tableRow1 = _.template($("#trow-main").html());
      //var tableRow2Tmpl = $("#table-row2").html();
      var tableRow2 = _.template($("#trow-details").html());
      // $("#report tbody").html( _.template(tableTemplate, { items: items }));

      var prevId = -1

      _.each(crit_items, function(citem, index, list) {
        //
        var trow;
        var litem;
        //
        if (citem['crit_num'] == prevId) {
          litem = tableRow2(citem);
          $("#tblfilter tbody tr td ul").last().append(litem);
        } else {
          trow = tableRow1(citem);
          $("#tblfilter tbody").append(trow);
          // reset the flag
          prevId = citem['crit_num'];
        }
      });

      //$("#report tr:odd").addClass("odd");
      // hide hidden columns
      $("#tblfilter th.hidden").hide();
      $("#tblfilter td.hidden").hide();
      $("#tblfilter tr th.toggle").next().hide();
      $("#tblfilter tr td.toggle").next().hide();

      $("#tblfilter tr").click(function() {
        // $("#tblfilter tr th.toggle").toggle();
        $(this).find("td.toggle").toggle();
        $(this).find(".arrow").toggleClass("up");
      });

      var table = $('#tblfilter').DataTable({
        paging: false,
        searching: false,
        order: [
          [0, 'asc']
        ],
        scrollY: 400,
        select: 'single',
        pageLength: 30
      });
      
      // store permanent objects into localStorage. 
      var myMap = {
        "1": [{
          "oper_id": 1,
          "oper_desc": "= (Equals)",
          "sql_oper": "="
        }, {
          "oper_id": 2,
          "oper_desc": "> (Greater Than)",
          "sql_oper": ">"
        }, {
          "oper_id": 3,
          "oper_desc": "< (Less Than)",
          "sql_oper": "<"
        }, {
          "oper_id": 4,
          "oper_desc": ">= (Grtr or Eql)",
          "sql_oper": ">="
        }, {
          "oper_id": 5,
          "oper_desc": "<= (Less or Eql)",
          "sql_oper": "<="
        }, {
          "oper_id": 6,
          "oper_desc": "<> (Not Equal)",
          "sql_oper": "<>"
        }, {
          "oper_id": 7,
          "oper_desc": "Between",
          "sql_oper": "Between"
        }],
        "2": [{
          "oper_id": 1,
          "oper_desc": "= (Equals)",
          "sql_oper": "="
        }, {
          "oper_id": 6,
          "oper_desc": "<> (Not Equal)",
          "sql_oper": "<>"
        }],
        "3": [{
          "oper_id": 1,
          "oper_desc": "= (Equals)",
          "sql_oper": "="
        }, {
          "oper_id": 6,
          "oper_desc": "<> (Not Equal)",
          "sql_oper": "<>"
        }, {
          "oper_id": 7,
          "oper_desc": "Between",
          "sql_oper": "Between"
        }],
        "4": [{
          "oper_id": 5,
          "oper_desc": "<= (Less or Eql)",
          "sql_oper": "<="
        }, {
          "oper_id": 1,
          "oper_desc": "= (Equals)",
          "sql_oper": "="
        }],
        "5": [{
          "oper_id": 9,
          "oper_desc": "Has",
          "sql_oper": "HAS"
        }],
        "6": [{
          "oper_id": 1,
          "oper_desc": "= (Equals)",
          "sql_oper": "="
        }],
        "7": [{
          "oper_id": 1,
          "oper_desc": "= (Equals)",
          "sql_oper": "="
        }, {
          "oper_id": 6,
          "oper_desc": "<> (Not Equal)",
          "sql_oper": "<>"
        }, {
          "oper_id": 7,
          "oper_desc": "Between",
          "sql_oper": "Between"
        }],
        "8": [{
          "oper_id": 8,
          "oper_desc": "Like",
          "sql_oper": "Like"
        }, {
          "oper_id": 10,
          "oper_desc": "Not Like",
          "sql_oper": "Not Like"
        }],
        "9": [{
          "oper_id": 1,
          "oper_desc": "= (Equals)",
          "sql_oper": "="
        }, {
          "oper_id": 2,
          "oper_desc": "> (Greater Than)",
          "sql_oper": ">"
        }, {
          "oper_id": 3,
          "oper_desc": "< (Less Than)",
          "sql_oper": "<"
        }, {
          "oper_id": 4,
          "oper_desc": ">= (Grtr or Eql)",
          "sql_oper": ">="
        }, {
          "oper_id": 5,
          "oper_desc": "<= (Less or Eql)",
          "sql_oper": "<="
        }, {
          "oper_id": 6,
          "oper_desc": "<> (Not Equal)",
          "sql_oper": "<>"
        }, {
          "oper_id": 7,
          "oper_desc": "Between",
          "sql_oper": "Between"
        }, {
          "oper_id": 11,
          "oper_desc": "Is Null",
          "sql_oper": "IS NULL"
        }, {
          "oper_id": 12,
          "oper_desc": "Is Not Null",
          "sql_oper": "IS NOT NULL"
        }],
        "10": [{
          "oper_id": 13,
          "oper_desc": "<= (Less or Eql)",
          "sql_oper": "<="
        }],
        "11": [{
          "oper_id": 1,
          "oper_desc": "= (Equals)",
          "sql_oper": "="
        }, {
          "oper_id": 2,
          "oper_desc": "> (Greater Than)",
          "sql_oper": ">"
        }, {
          "oper_id": 3,
          "oper_desc": "< (Less Than)",
          "sql_oper": "<"
        }, {
          "oper_id": 4,
          "oper_desc": ">= (Grtr or Eql)",
          "sql_oper": ">="
        }, {
          "oper_id": 5,
          "oper_desc": "<= (Less or Eql)",
          "sql_oper": "<="
        }, {
          "oper_id": 6,
          "oper_desc": "<> (Not Equal)",
          "sql_oper": "<>"
        }],
        "12": [{
          "oper_id": 5,
          "oper_desc": "<= (Less or Eql)",
          "sql_oper": "<="
        }, {
          "oper_id": 1,
          "oper_desc": "= (Equals)",
          "sql_oper": "="
        }, {
          "oper_id": 7,
          "oper_desc": "Between",
          "sql_oper": "Between"
        }]
      };

      //win.localStorage.setItem("gqas.operators", JSON.stringify(myMap));
      $.storeData('localStorage', 'gqas.operators', myMap);
      // create the main application objects
      win.gqasApp = new win.JqData($('#main-content'));
      win.jqOptions = new win.JqObject($('#myModal'));
      win.jqFltrList = new win.JqObject($('#fltrlist'));
      win.jqFltrValue = new win.JqObject($('#fltrValue'));
      // create global variables and initialize. 
      gqasApp.filterVar = {};
      // retrieve the operator map from localStorage. 
      var opermap = $.storeData('localStorage', 'gqas.operators');
      // compile underscore template  
      jqOptions.templateCompile('operTemplate', $("script.opertemplate").html());
      // get the operator list based on operator group. 
      jqOptions.getOperators = function(operGrp, jqULSelector) {
        if (!operGrp) throw new Error("getOperators requires an operator group value!");
        var length = ($(jqULSelector).length === 1) ? 1 : 0;
        if (!length) throw new Error("getOperators requires a jQuery container selector.");
        // 
        var operList = opermap[operGrp];
        var operData = {
          operators: operList
        };
        // console.log('operData is ' + operData);
        var htmlFrag = this.templateExecute('operTemplate', operData);
        // clear the list first 
        this.appendFrag(jqULSelector, htmlFrag);
      }; // getOperators
      // compile the options list based on the options string. 
      jqOptions.templateCompile('optionTemplate', $("script.optiontemplate").html());
      // 
      jqOptions.getOptions = function(options, jqOptSelector) {
        if (!options) throw new Error("getOptions requires options value!");
        var length = ($(jqOptSelector).length === 1) ? 1 : 0;
        if (!length) throw new Error("getOptions requires a List Options container selector.");
        //console.log( 'getOptions is called with options as ' + options );
        var optList = [];
        var opt = {};
        var vgCount = 0;

        // almost every filter has 'T'
        if (options.indexOf('T') >= 0) {
          // push the item to array. 
          opt = {
            "optId": "T",
            "optDesc": "(T)Type In"
          };

          optList.unshift(opt);
        }

        if (options.indexOf('G') >= 0) {
          // push the item to the array. 
          opt = {
            "optId": "G",
            "optDesc": "(G)Groups Only"
          };

          optList.unshift(opt);
          vgCount++;
        }

        if (options.indexOf('V') >= 0) {
          // push the item to the array. 
          opt = {
            "optId": "V",
            "optDesc": "(V)Values Only"
          };

          optList.unshift(opt);
          vgCount++;
        }

        // check the length ... if 2 then give VG option
        if (vgCount > 1) {
          opt = {
            "optId": "VG",
            "optDesc": "(VG)Values Groups"
          };
          // add to the front of the array. 
          optList.unshift(opt);
        }

        var info = 'getOptions optList length is ' + optList.length + '; optId items are ';
        for (var i = 0; i < optList.length; i++) {
          info += optList[i]['optId'] + ';';
        }

        var htmlFrag = this.templateExecute('optionTemplate', {
          options: optList
        });
        // append the html fragment to the selector
        this.appendFrag(jqOptSelector, htmlFrag);
      }; // end getOptions 

      // myModal functions and binds. 
      jqOptions.selectors.myModal = '#myModal';
      jqOptions.selectors.optSave = '#optSave';

      $.bindEvent(jqOptions.selectors.myModal, 'show.bs.modal', undefined, function() {
        console.log('myModal show.bs.modal event fired.');
        jqOptions.getOperators(gqasApp.filterVar.opergrp, '#lbOper');
        jqOptions.getOptions(gqasApp.filterVar.options, '#lbOpt');
      });

      function listDefaults() {
        console.log('myModal shown.bs.modal event fired.');
        // select the operator default item and set the following text input element also. 
        var $item = $('#lbOper li:eq(0)');
        $item.trigger('click');
        // select the default option list item and set the text input value. 
        var optDefault = gqasApp.filterVar.optdefault;
        var optLength = optDefault.length;
        // find the li value in the string ( VG+ stripped of + sign to VG )
        optDefault = optDefault.indexOf('+') < 0 ? optDefault : optDefault.substr(0, optLength - 1);
        console.log('myModal shown.bs.modal used optDefault ' + optDefault);
        var $item2 = $('#lbOpt').find('li[id="' + optDefault + '"]');
        // same as $item2 != null 
        if ($item2) {
          $item2.trigger('click');
          console.log('lbOpt li item found.');
        } else {
          $('#lbOpt li:eq(0)').trigger('click');
          console.log('lbOpt li item not found. Default to first value');
        }
        // 
        var $control = $('#lbValid').parent('.dropdown').find('.dropdown-toggle');
        var $item3;
        if (gqasApp.filterVar.optdefault.indexOf('+') < 0) {
          // select the first li item. 
          $item3 = $('#lbValid li:eq(0)');
          // set the text input value. 
          $item3.trigger('click');
          // disable the list 
          $control.addClass('disabled');
        } else {
          // enable selector
          $control.removeClass('disabled');
          // select "Valid Rows Only" and set the text input value. 
          $item3 = $('#lbValid li:eq(1)');
          //$item.addClass('selected');
          $item3.trigger('click');
        }
      }
      // set default values 
      $.bindEvent(jqOptions.selectors.myModal, 'shown.bs.modal', undefined, listDefaults);

      $.bindEvent(jqOptions.selectors.optSave, 'click', undefined, function() {
        // trigger a global event
        // lbOperTxt;lbOptTxt;lbValidTxt
        var operTxtVal = $('#lbOperTxt').attr('idVal');
        var optTxtVal = $('#lbOptTxt').attr('idVal');
        var validTxtVal = $('#lbValidTxt').attr('idVal');

        var optionsVal = undefined;
        gqasApp.filterVar.optionsVal = undefined;
        // ( optTxtVal.indexOf('T') >= 0 )  ? optTxtVal:undefined;
        switch (optTxtVal) {
          case 'VG':
            optionsVal = 'VG';
            break;
          case 'V':
            optionsVal = 'V';
            break;
          case 'G':
            optionsVal = 'G';
            break;
          default:
            console.log('#optSave switch optTxtVal should be T: ' + optTxtVal);
        }

        if (optionsVal) {
          // add the valid rows option if indicated. 
          optionsVal = validTxtVal.indexOf('+') < 0 ? optionsVal : optionsVal += '+';
          // save into global data  
          gqasApp.filterVar.optionsVal = optionsVal;
          console.log('#optSave optionsVal used is ' + gqasApp.filterVar.optionsVal);
          // trigger the application event. 
          gqasApp.container.triggerHandler('gqas.filter.select');
        }
        // disable the add button
        $("#btnVAdd").prop("disabled", true);
        $("#btnVAdd").removeClass("btn-primary");
      });


      // create filters list table.  
      var createTable1 = function() {

        var columnsArray = [{
          data: 'groupId'
        }, {
          data: 'filterOptionDflt'
        }, {
          data: 'filterDesc'
        }, {
          data: 'groupName'
        }, {
          data: 'filterOptionList'
        }, {
          data: 'filterPointer'
        }, {
          data: 'operGrpId'
        }, {
          data: 'filterId'
        }, {
          data: 'filterLoaded'
        }, {
          data: 'filterUse'
        }, {
          data: 'filterColType'
        }, {
          data: 'filterSingleSel'
        }, {
          data: 'filterQasCol1'
        }, {
          data: 'filterQasCol2'
        }, {
          data: 'filterQasCol3'
        }, {
          data: 'filterQasCol4'
        }, {
          data: 'filterQasCol5'
        }];

        var dtable = $('#tblFltrSelect').DataTable({
          "columns": columnsArray,
          "searching": false,
          "paging": false,
          "scrollY": "480px",
          "scrollCollapse": true,
          "select": "single",
          "ordering": false,
          /*
          ,
          "columnDefs": [{
            "targets": [1, 2],
            "orderable": false
          }]
      
          ,
          "order": [
            [0, 'asc']
          ]
          */
          "createdRow": function(row, data, dataIndex) {
            $(row).addClass('toggle');
            $(row).attr('groupid', data.groupId);
            $(row).attr('filterid', data.filterId);
            $(row).attr('options', data.filterOptionList);
            $(row).attr('opergrp', data.operGrpId);
            $(row).attr('optdefault', data.filterOptionDflt);
            //
            var qasNumEl = 0;
            //var qasCol = [];
            var qasCol = '';

            if (data.filterQasCol1 != 'null') {
              qasNumEl = qasNumEl + 1;
              //qasCol.push( data.filterQasCol1 );
              qasCol += data.filterQasCol1;
            };
            if (data.filterQasCol2 != 'null') {
              qasNumEl = qasNumEl + 1;
              //qasCol.push( data.filterQasCol2 );
              qasCol += ';' + data.filterQasCol2;
            };
            if (data.filterQasCol3 != 'null') {
              qasNumEl = qasNumEl + 1;
              //qasCol.push( data.filterQasCol3 );
              qasCol += ';' + data.filterQasCol3;
            }
            if (data.filterQasCol4 != 'null') {
              qasNumEl = qasNumEl + 1;
              //qasCol.push( data.filterQasCol4 );
              qasCol += ';' + data.filterQasCol4;
            }
            if (data.filterQasCol5 != 'null') {
              qasNumEl = qasNumEl + 1;
              //qasCol.push( data.filterQasCol5 );
              qasCol += ';' + data.filterQasCol5;
            }
            // numcol attribute is the column index to show in table2.  
            $(row).attr('numcol', qasNumEl);
            $(row).attr('qascol', qasCol);
            // for this table only show 3 columns
            $(row).find('td').each(
              function(indx, el) {
                if (indx >= 3) $(this).addClass('hidden');
              }
            ); // end each
          }, // end createdRow
          //
          "drawCallback": function(settings) {
              // get the api. 
              var api = this.api();
              // get all DOM 'tr' nodes.
              var rows = api.rows({
                page: 'all'
              }).nodes();
              // flag for each group
              var last = null;
              // collect all values from column 3. insert new row when group changes value
              api.column(3, {
                  page: 'all'
                })
                .data()
                .each(function(group, i) {
                    // if the group id changes value then add a additional group header row before the row.  
                    if (last !== group) {
                      $(rows).eq(i).before(
                        '<tr class="group"><td colspan="5">' + group + '</td></tr>'
                      );
                      last = group;
                    }
                  } // end .each
                );
            } // end drawCallback
        }); // end datatable

        return dtable;
      }

      jqFltrList.table1 = createTable1();

      jqFltrList.selectors.tbody = '#tblFltrSelect tbody';
      jqFltrList.selectors.trtoggle = '#tblFltrSelect tr.toggle';
      jqFltrList.selectors.btnopt = '#btnOpt';
      // var selector = jqFltrList.selector['tbody'];
      $.bindEvent(jqFltrList.selectors.tbody, 'click', 'tr.group', function() {
        // hide all siblings with class 'tr.toggle
        var thisGroup = $(this).next("tr.toggle").nextUntil("tr.group");
        thisGroup.toggle();
        // deselect all rows. 
        jqFltrList.table1.rows().deselect();
      });

      // capture data from the tr.toggle row. 
      $.bindEvent(jqFltrList.selectors.tbody, 'click', 'tr.toggle', function() {
        gqasApp.filterVar.filterId = $(this).attr('filterid');
        gqasApp.filterVar.options = $(this).attr('options');
        gqasApp.filterVar.opergrp = $(this).attr('opergrp');
        gqasApp.filterVar.numcol = $(this).attr('numcol');
        gqasApp.filterVar.qascol = $(this).attr('qascol');
        gqasApp.filterVar.optdefault = $(this).attr('optdefault');
      });

      // if table1 rows are selected. 
      jqFltrList.table1.on('select', function(e, dt, type, indexes) {
        $(jqFltrList.selectors.btnopt).prop("disabled", false);
        $(jqFltrList.selectors.btnopt).addClass("btn-primary");
      });

      // if table1 rows are deselected. 
      jqFltrList.table1.on('deselect', function(e, dt, type, indexes) {
        $("#btnOpt").prop("disabled", true);
        $("#btnOpt").removeClass("btn-primary");
      });

      //jqFltrList.container.on("gqas.filterlist.ready", function () {
      $.refbindEvent(jqFltrList.container, 'gqas.filterlist.ready', undefined, function() {
        console.log("Event gqas.filterlist.ready fired.");
        var data = gqasApp.cacheData('items');
        // jqFltrList.table1.rows.add(gqasApp.items).draw();
        jqFltrList.table1.rows.add(data).draw();
        // deselect all rows. 
        jqFltrList.table1.rows().deselect();
        // $("#tblFltrSelect tr.toggle").hide();
        $(jqFltrList.selectors.trtoggle).hide();
      });

      // create filter values table. 
      var createTable2 = function() {

        var fltrVCol = [{
          data: 'fdesc'
        }, {
          data: 'valCol1'
        }, {
          data: 'valCol2'
        }, {
          data: 'valCol3'
        }, {
          data: 'valCol4'
        }, {
          data: 'valCol5'
        }, {
          data: 'groupId'
        }, {
          data: 'groupOwner'
        }, {
          data: 'groupName'
        }];

        var dtable = $('#tblFltrValues').DataTable({
          "columns": fltrVCol,
          "paging": false,
          "scrollY": "400px",
          "scrollCollapse": true,
          "ordering": false
            /*
            , "createdRow": function(row, data, dataIndex) {
                $(row).find('td').each(
                  function(indx, el) {
                    if (indx >= 6) $(this).addClass('hidden');
                  }
                ); // end each
              } // end createdRow function
            */
        }); // end table2

        return dtable;
      }

      jqFltrValue.table2 = createTable2();

      // fill second table when list is ready
      $.refbindEvent(jqFltrValue.container, 'gqas.filtervalues.ready', undefined, function() {

        console.log("Event gqas.filtervalues.ready fired.");
        jqFltrValue.table2.clear();
        // jqFltrValue.table2.rows.add(gqasApp.fltrValues);
        var data = gqasApp.cacheData('fvalues');
        jqFltrValue.table2.rows.add(data);
        jqFltrValue.table2.draw();

        var numCol = gqasApp.filterVar.numcol;
        numCol++;
        console.log("gqas.filtervalues.ready variable numCol is " + numCol);

        var qasCol = gqasApp.filterVar.qascol.split(';');
        console.log("gqas.filtervalues.ready variable qasCol is  " + qasCol);

        for (i = 0; i < 9; i++) {

          if (i < numCol) {
            jqFltrValue.table2.column(i).visible(true, false);
            if (i > 0) {
              $(jqFltrValue.table2.column(i).header()).text(qasCol.shift());
            }
          } else {
            jqFltrValue.table2.column(i).visible(false, false);
          }
        }

        jqFltrValue.table2.columns.adjust().draw(false);

      });

      // ajax config 
      var settings = {
        crossDomain: true,
        xhrFields: {
          withCredentials: true
        },
        beforeSend: function(xhr) {
          var token = sessionStorage.getItem("xauth");
          if (token) {
            xhr.setRequestHeader('X-Auth-Token', token);
            console.log("ajax beforeSend used session token " + token);
          } else {
            xhr.setRequestHeader('authorization', 'Basic ' + btoa(
              'wfan10:password2'));
            console.log("ajax beforeSend did not use session token.");
          }
        }
      };

      // set the ajaxConfig object. 
      var ajaxname1 = 'filterlist';
      var baseurl1 = "http://localhost:9000/filterlist";
      gqasApp.ajaxConfig(ajaxname1, 'GET', baseurl1, settings);


      $.refbindEvent(gqasApp.container, 'gqasApp.startup', undefined, function() {
        // retrieve items from stored.   
        var items = $.storeData('localStorage', 'items');
        gqasApp.cacheData('items', items);

        if (_.isEmpty(items)) {
          // do ajax to fetch table1 data'
          var jqXHR = gqasApp.executeAjax(ajaxname1, undefined, undefined);

          jqXHR.done(function(data, textStatus, xhr) {
            console.log('ajax succeeded: response headers ' + xhr.getAllResponseHeaders());
            //  if we get the token in the response ... then save it. 
            var xauth = xhr.getResponseHeader('X-Auth-Token');
            if (xauth) {
              sessionStorage.setItem("xauth", xauth);
            };
            // store and cache the data 
            $.storeData('localStorage', 'items', data);
            $(this).cacheData('items', data);
          });

          jqXHR.fail(function(xhr, textStatus, errorThrown) {
            $(this).cacheData('items', []);
            console.error('ajax failed: error ' + errorThrown.toString());
          });
        }
        // post a DOM event
        jqFltrList.container.triggerHandler("gqas.filterlist.ready");

      });

      // configure the second ajax function call. 
      var ajaxname2 = 'filtervalues';
      var baseurl2 = "http://localhost:9000/filtervalues";
      gqasApp.ajaxConfig(ajaxname2, 'GET', baseurl2, settings);

      // send the ajax function to get the filter values. 
      // $(document).on('gqas.filter.select', function () {
      $.refbindEvent(gqasApp.container, 'gqas.filter.select', undefined, function() {
        //final url = "http://localhost:9000/filtervalues/" + gqasApp.filterVar.filterId + "?options=" + gqasApp.filterVar.optionsVal;
        var urlquery = gqasApp.filterVar.filterId + "?options=" + gqasApp.filterVar.optionsVal;

        var jqXhr2 = gqasApp.executeAjax(ajaxname2, urlquery, undefined);

        jqXhr2.done(function(data, textStatus, xhr) {
          console.log('ajax succeeded: response headers ' + xhr.getAllResponseHeaders());
          // gqasApp.fltrValues = data;
          gqasApp.cacheData('fvalues', data);
          //  if we get the token in the response ... then save it. 
          var xauth = xhr.getResponseHeader('X-Auth-Token');
          if (xauth) {
            sessionStorage.setItem("xauth", xauth);
          };
          // post a DOM event
          jqFltrValue.container.triggerHandler("gqas.filtervalues.ready");
        });

        jqXhr2.fail(function(xhr, textStatus, errorThrown) {
          var data = [];
          gqasApp.cacheData('fvalues', data);
          console.error('ajax failed: error ' + errorThrown.toString());
        });
      });

      // start up the application. 
      gqasApp.container.triggerHandler('gqasApp.startup');

    })(jQuery, window);
  </script>
</body>

</html>